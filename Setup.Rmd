---
title: "Real-time imputation SIG project"
output:
  html_document:
    df_print: paged
---

# Data Generating Mechanism

We will use a prediction model with: 

- 1 binary outcome ($Y$),
- 10 continuous predictors ($X_1$, $X_2$, ..., $X_{10}$).

Our sample will include at least these variables. **Q:** Do we want extra 'support' variables ($Z$) in our sample that are not included in the prediction model?

```{r setup, message = FALSE, warning = FALSE, include = FALSE}
# environment
library("mvtnorm")
library("dplyr")
library("pROC")

# data
load("./Data/varcov.RData")

# functions
source("./R/DGM.R")
```


```{r}
# let's generate some data
set.seed(11)
n <- 10000

# we'll use the SMART data to define the relations between predictors
ggcorrplot::ggcorrplot(cov2cor(varcov), hc.order = TRUE, type = "lower", lab = TRUE)

# create the data
dat <- generate_sample(n, varcov)
glimpse(dat)

# check characteristics
(prevalence <- mean(dat$Y))

# fit prediction model 
mod <- glm(Y ~ ., family = "binomial", data = dat)

# check model characteristics
(auc <- pROC::roc(Y~prob, data = cbind(dat, prob=predict(mod))))
```

The prevalence of the outcome is `r round(prevalence, 2)`. The C index/AUC of the model is `r round(auc$auc, 2)`. **Q:** What other characteristics do we need to check?

```{r}
# now add some interaction terms (actually 1 squared term, 9 interactions)
dat <- generate_sample(n, varcov, interaction = TRUE)
# check the same characteristics
(prevalence <- mean(dat$Y))
mod <- glm(Y ~ ., family = "binomial", data = dat)
dat <- cbind(dat, prob=predict(mod))
(auc <- pROC::roc(Y~prob, data = dat))
```

The prevalence of the outcome now is `r round(prevalence, 2)`. The C index/AUC of the model is `r round(auc$auc, 2)`.